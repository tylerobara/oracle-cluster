database:
  image:
    registry: ghcr.io
    repository: cloudnative-pg/postgresql
    tag: 18

  clusterName: authentik
  logLevel: error
  replicas: 1
  size: 200Mi

  monitoring:
    enabled: false

  backups:
    enabled: false
    secretName: ''
    retention: ''
    path: ''
    endpoint: ''

  topologySpreadConstraints:

externalSecrets:
  secretStoreRef:
    name: oracle-cluster-secret-store
    kind: ClusterSecretStore
  target:
    name: authentik-secrets
  data:
  - secretKey: username
    remoteRef:
      key: default/authentik
      property: db_username
  - secretKey: password
    remoteRef:
      key: default/authentik
      property: db_password
  - secretKey: AUTHENTIK_SECRET_KEY
    remoteRef:
      key: default/authentik
      property: secret_key

authentik:
  authentik:
    secret_key: "PleaseGenerateA50CharKey"
    error_reporting:
      enabled: false
    postgresql:
      host: authentik-rw
      user: file:///postgres-creds/username
      password: file:///postgres-creds/password

  server:
    env:
      - name: AUTHENTIK_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: authentik-secrets
            key: secret_key
    volumes:
      - name: postgres-creds
        secret:
          secretName: authentik-secrets
    volumeMounts:
      - name: postgres-creds
        mountPath: /postgres-creds
        readOnly: true
    ingress:
      ingressClassName: "traefik"
      enabled: true
      hosts:
        - auth.cloud.obara.xyz

  worker:
    volumes:
      - name: postgres-creds
        secret:
          secretName: authentik-secrets
    volumeMounts:
      - name: postgres-creds
        mountPath: /postgres-creds
        readOnly: true

  postgresql:
    enabled: false

